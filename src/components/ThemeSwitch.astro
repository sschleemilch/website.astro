---
import { Icon } from "astro-icon/components";
---

<button id="theme-switcher" aria-label="Theme switch button" class="text-2xl text-muted dark:text-mutedDark hover:text-text dark:hover:text-textDark">
  <Icon name="line-md:sunny-loop" class="dark:hidden block" />
  <Icon name="line-md:moon-loop" class="hidden dark:block" />
</button>

<script>
  const setToggleListener = () => {
    let toggleBtn = document.getElementById("theme-switcher");
    const handleToggleClick = () => {
      const element = document.documentElement;
      element.classList.toggle("dark");

      const isDark = element.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    toggleBtn?.addEventListener("click", handleToggleClick);
  };

  setToggleListener();

  document.addEventListener("astro:after-swap", setToggleListener);
</script>
